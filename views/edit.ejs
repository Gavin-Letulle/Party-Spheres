<%- include('./partials/header', { currentPage: 'account'}) %>

<div class="account-form">
    <h2>Edit Account Details</h2>

    <% if (error) { %>
        <div class="error-message"><%= error %></div>
    <% } %>

    <form action="/edit" method="POST">
        <div class="account-form-group">
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" value="<%= user.username %>" required />
        </div>
        <div class="account-form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" value="<%= user.email %>" required />
        </div>
        <div class="account-form-group">
            <label for="player_name">Full Name:</label>
            <input type="text" id="player_name" name="player_name" value="<%= user.player_name %>" />
        </div>
        <div class="account-form-group">
            <label for="bio">Bio:</label>
            <textarea id="bio" name="bio" rows="4"><%= user.bio ? user.bio : '' %></textarea>
        </div>

        <div class="account-form-group">
            <label for="profileImage">Profile Image:</label>
            <select id="profileImage" name="img_path">
                <% images.forEach(image => { %>
                    <option value="/images/<%= image %>" <%= user.img_path === ('/images/' + image) ? 'selected' : '' %>>
                        <%= image %>
                    </option>
                <% }); %>
            </select>
            <div class="profile-preview">
                <img id="profilePreview" src="<%= user.img_path %>" alt="Profile Image">
            </div>
        </div>

        <div class="account-form-group">
            <label for="password">New Password:</label>
            <input type="password" id="password" name="password" placeholder="Enter new password" />
        </div>
        <div class="account-form-group">
            <label for="confirmPassword">Verify Password:</label>
            <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm new password" />
        </div>

        <div class="account-form-group" style="margin-top: 20px;">
            <button type="submit" class="big-button" id="editButton">Save Changes</button>
        </div>
    </form>

    <form id="deleteForm" action="/edit" method="POST" style="margin-top: 20px;">
        <input type="hidden" name="deleteAccount" value="true">
        <button type="button" class="big-button" id="deleteButton">Delete Account</button>
    </form>
</div>

<script>
    document.getElementById('deleteButton').addEventListener('click', function(event) {
        event.preventDefault();

        if (confirm('Are you sure you want to delete your account? This action is irreversible.')) {
            document.getElementById('deleteForm').submit();
        }
    });
    const profileImageSelect = document.getElementById('profileImage');
    const profilePreview = document.getElementById('profilePreview');

    profileImageSelect.addEventListener('change', function () {
        const selectedImage = this.value;
        profilePreview.src = selectedImage;
    });
</script>

<%- include('./partials/footer') %>

